<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS Smart Engine Pro</title>
    <style>
        :root { --ag-green: #67bc91; --cf-orange: #f38020; --ag-dark: #0f0f0f; --ag-card: #1c1c1e; --ag-gray: #8e8e93; --ag-red: #ff453a; }
        body { background: var(--ag-dark); color: white; font-family: -apple-system, sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 40px; }
        
        .header { margin-top: 20px; font-weight: bold; letter-spacing: 2px; color: var(--ag-gray); font-size: 14px; }

        /* Shield Section */
        .shield-section { margin: 30px 0; position: relative; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; }
        .shield-circle { width: 140px; height: 140px; border-radius: 50%; border: 4px solid #333; transition: 0.4s; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.02); }
        .active-circle { border-color: var(--ag-green) !important; box-shadow: 0 0 50px rgba(103, 188, 145, 0.3); }
        .shield-icon { font-size: 60px; transition: 0.5s; filter: grayscale(1); opacity: 0.3; }
        .active-icon { filter: grayscale(0) !important; opacity: 1 !important; transform: scale(1.1); }
        .loader { position: absolute; width: 165px; height: 165px; border: 4px solid transparent; border-top-color: var(--ag-green); border-radius: 50%; display: none; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .status-label { font-size: 18px; font-weight: bold; color: #555; margin-bottom: 20px; text-transform: uppercase; }
        .status-on { color: var(--ag-green) !important; }

        /* Setup Menu */
        #setup-menu { width: 92%; max-width: 420px; display: none; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .group-title { font-size: 11px; color: var(--ag-gray); margin: 25px 5px 10px; text-transform: uppercase; font-weight: bold; }
        .menu-item { background: var(--ag-card); border-radius: 15px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: 0.2s; border: 1px solid #2c2c2e; }
        .menu-item:active { transform: scale(0.96); }
        .icon-box { width: 40px; height: 40px; background: #2c2c2e; border-radius: 10px; margin-right: 15px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .badge { font-size: 10px; padding: 3px 10px; border-radius: 10px; font-weight: bold; background: #333; }

        /* Checker Box */
        .checker-box { width: 92%; max-width: 420px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #333; }
        .check-item { background: #151517; border-radius: 12px; padding: 15px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; font-size: 14px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--ag-gray); margin-right: 10px; display: inline-block; }
        .dot-on { background: var(--ag-green); box-shadow: 0 0 10px var(--ag-green); }

        /* Modal - S·ª≠a l·ªói d√≠nh ch·ªØ & CƒÉn ch·ªânh d·∫•u c√°ch */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); }
        .modal-content { background: #1c1c1e; margin: 15% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 380px; border: 1px solid #333; }
        .modal-title { font-size: 18px; font-weight: bold; color: var(--ag-green); margin-bottom: 25px; text-align: center; border-bottom: 1px solid #333; padding-bottom: 15px; }
        
        .step-list { margin-bottom: 25px; }
        .step-row { display: flex; align-items: flex-start; margin-bottom: 20px; } 
        .step-circle { background: var(--ag-green); color: black; border-radius: 50%; min-width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: bold; margin-right: 15px; margin-top: 2px; }
        .step-text { font-size: 15px; line-height: 1.6; color: #ddd; flex: 1; }
        
        .btn-close { width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--ag-green); color: black; font-weight: bold; font-size: 16px; cursor: pointer; }
        .btn-link { color: var(--ag-green); text-decoration: underline; font-weight: bold; }
        .refresh-notice { font-size: 10px; color: #444; text-align: center; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="header">DNS SMART ENGINE PRO</div>

    <div class="shield-section" onclick="toggleSystem()">
        <div class="loader" id="loader"></div>
        <div class="shield-circle" id="circle">
            <div class="shield-icon" id="icon">üõ°Ô∏è</div>
        </div>
    </div>

    <div class="status-label" id="status">CH·∫æ ƒê·ªò CH·ªú</div>

    <div id="setup-menu">
        <div class="group-title">ADGUARD (CH·∫∂N QU·∫¢NG C√ÅO)</div>
        <div class="menu-item" onclick="downloadWindows('AdGuard')">
            <div style="display:flex; align-items:center;"><div class="icon-box">üñ•Ô∏è</div><div><b>Windows Auto Fix</b></div></div>
            <div class="badge" style="color:var(--ag-green)">BAT</div>
        </div>
        <div class="menu-item" onclick="handleInstall('ios', 'AdGuard')">
            <div style="display:flex; align-items:center;"><div class="icon-box">üçé</div><div><b>iOS Profile</b></div></div>
            <div class="badge" style="color:var(--ag-green)">MOBILECONFIG</div>
        </div>
        <div class="menu-item" onclick="handleInstall('android', 'AdGuard')">
            <div style="display:flex; align-items:center;"><div class="icon-box">ü§ñ</div><div><b>Android OVPN</b></div></div>
            <div class="badge" style="color:var(--ag-green)">OPENVPN</div>
        </div>

        <div class="group-title">CLOUDFLARE (T·ªêC ƒê·ªò 1.1.1.1)</div>
        <div class="menu-item" onclick="downloadWindows('Cloudflare')">
            <div style="display:flex; align-items:center;"><div class="icon-box">‚ö°</div><div><b>Windows 1.1.1.1</b></div></div>
            <div class="badge" style="color:var(--cf-orange)">FAST</div>
        </div>
        <div class="menu-item" onclick="handleInstall('ios', 'Cloudflare')">
            <div style="display:flex; align-items:center;"><div class="icon-box">üçé</div><div><b>iOS 1.1.1.1</b></div></div>
            <div class="badge" style="color:var(--cf-orange)">SECURE</div>
        </div>
        <div class="menu-item" onclick="handleInstall('android', 'Cloudflare')">
            <div style="display:flex; align-items:center;"><div class="icon-box">ü§ñ</div><div><b>Android 1.1.1.1</b></div></div>
            <div class="badge" style="color:var(--cf-orange)">OPENVPN</div>
        </div>
    </div>

    <div class="checker-box">
        <div class="group-title" style="color:var(--ag-red);">KI·ªÇM TRA TH·ª∞C T·∫æ</div>
        <div class="check-item">
            <span><span class="dot" id="dot-ag"></span>AdGuard Status</span>
            <small id="txt-ag" style="color:var(--ag-gray)">OFFLINE</small>
        </div>
        <div class="check-item">
            <span><span class="dot" id="dot-cf"></span>Cloudflare Status</span>
            <small id="txt-cf" style="color:var(--ag-gray)">OFFLINE</small>
        </div>
        <button onclick="runCheck()" style="width:100%; padding:12px; border-radius:10px; border:none; background:#222; color:white; font-weight:bold; cursor:pointer; margin-top:10px;">L√ÄM M·ªöI QU√âT</button>
        <div class="refresh-notice">T·ª± ƒë·ªông qu√©t sau m·ªói 30 gi√¢y</div>
    </div>

    <div id="guideModal" class="modal">
        <div class="modal-content">
            <div id="modalTitle" class="modal-title">H∆Ø·ªöNG D·∫™N</div>
            <div id="modalSteps" class="step-list"></div>
            <button class="btn-close" onclick="closeModal()">ƒê√É HI·ªÇU</button>
        </div>
    </div>

    <script>
        let isPowerOn = false;
        const AG_ID = "cc1a659b-a5b6-4fb1-b829-4ee1969f1c99";

        window.onload = () => { 
            runCheck(); 
            if (localStorage.getItem('dnsPower') === 'true') {
                applyOnUI();
            }
            setInterval(runCheck, 30000);
        };

        function toggleSystem() {
            const loader = document.getElementById('loader');
            if (!isPowerOn) {
                loader.style.display = "block";
                document.getElementById('status').innerText = "ƒêANG QU√âT THI·∫æT B·ªä...";
                setTimeout(() => {
                    loader.style.display = "none";
                    applyOnUI();
                    localStorage.setItem('dnsPower', 'true');
                }, 800);
            } else {
                applyOffUI();
                localStorage.setItem('dnsPower', 'false');
            }
        }

        function applyOnUI() {
            isPowerOn = true;
            document.getElementById('circle').classList.add('active-circle');
            document.getElementById('icon').classList.add('active-icon');
            document.getElementById('status').innerText = "H·ªÜ TH·ªêNG ƒê√É M·ªû";
            document.getElementById('status').classList.add('status-on');
            document.getElementById('setup-menu').style.display = 'block';
        }

        function applyOffUI() {
            isPowerOn = false;
            document.getElementById('circle').classList.remove('active-circle');
            document.getElementById('icon').classList.remove('active-icon');
            document.getElementById('status').innerText = "CH·∫æ ƒê·ªò CH·ªú";
            document.getElementById('status').classList.remove('status-on');
            document.getElementById('setup-menu').style.display = 'none';
        }

        async function runCheck() {
            const img = new Image();
            img.onload = () => updateUI('ag', true, 'ACTIVE');
            img.onerror = () => updateUI('ag', false, 'OFFLINE');
            img.src = `https://${AG_ID}.dns.nextdns.io/favicon.ico?` + Date.now();

            try {
                const res = await fetch('https://1.1.1.1/cdn-cgi/trace');
                const text = await res.text();
                updateUI('cf', text.includes('dns=on'), text.includes('dns=on') ? 'ONLINE' : 'OFFLINE');
            } catch (e) { updateUI('cf', false, 'OFFLINE'); }
        }

        function updateUI(id, active, text) {
            const dot = document.getElementById('dot-' + id);
            const txt = document.getElementById('txt-' + id);
            dot.className = active ? 'dot dot-on' : 'dot';
            txt.innerText = text;
            txt.style.color = active ? "var(--ag-green)" : "var(--ag-gray)";
        }

        function showModal(type, stepsArray) {
            document.getElementById('modalTitle').innerText = "C√ÄI ƒê·∫∂T " + type.toUpperCase();
            let html = "";
            stepsArray.forEach((step, i) => {
                html += `
                    <div class="step-row">
                        <div class="step-circle">${i + 1}</div>
                        <div class="step-text">${step}</div>
                    </div>
                `;
            });
            document.getElementById('modalSteps').innerHTML = html;
            document.getElementById('guideModal').style.display = 'block';
        }

        function handleInstall(platform, type) {
            if (platform === 'ios') {
                let url = (type === 'AdGuard') ? `https://dns.nextdns.io/${AG_ID}` : "https://cloudflare-dns.com/dns-query";
                const profile = `<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><plist version="1.0"><dict><key>PayloadContent</key><array><dict><key>DNSSettings</key><dict><key>DNSProtocol</key><string>HTTPS</string><key>ServerURL</key><string>${url}</string></dict><key>PayloadType</key><string>com.apple.dnsSettings.managed</string><key>PayloadIdentifier</key><string>com.dns</string><key>PayloadUUID</key><string>1</string><key>PayloadVersion</key><integer>1</integer></dict></array><key>PayloadDisplayName</key><string>${type} DNS</string><key>PayloadIdentifier</key><string>com.setup</string><key>PayloadType</key><string>Configuration</string><key>PayloadUUID</key><string>2</string><key>PayloadVersion</key><integer>1</integer></dict></plist>`;
                downloadFile(profile, `${type}_iOS.mobileconfig`);
                showModal(type, [
                    "Nh·∫•n <b>Cho ph√©p</b> ƒë·ªÉ t·∫£i h·ªì s∆° c·∫•u h√¨nh.",
                    "M·ªü <b>C√†i ƒë·∫∑t</b> -> Ch·ªçn <b>ƒê√£ t·∫£i v·ªÅ h·ªì s∆°</b>.",
                    "Nh·∫•n <b>C√†i ƒë·∫∑t</b> ·ªü g√≥c tr√™n b√™n ph·∫£i ƒë·ªÉ ho√†n t·∫•t."
                ]);
            } else if (platform === 'android') {
                const host = (type === 'AdGuard') ? "45.90.28.66" : "1.1.1.1";
                const ovpn = `client\ndev tun\nproto udp\nremote ${host} 53\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nverb 3\ndhcp-option DNS ${host}`;
                downloadFile(ovpn, `${type}_Android.ovpn`);
                showModal(type, [
                    `T·∫£i ·ª©ng d·ª•ng: <a class="btn-link" href="https://play.google.com/store/apps/details?id=net.openvpn.openvpn" target="_blank">OpenVPN Connect</a>`,
                    "M·ªü App, ch·ªçn tab <b>FILE</b> v√† nh·∫≠p file v·ª´a t·∫£i.",
                    "Nh·∫•n <b>IMPORT</b> r·ªìi g·∫°t c√¥ng t·∫Øc ƒë·ªÉ k·∫øt n·ªëi."
                ]);
            }
        }

        function downloadWindows(type) {
            let dns1 = (type === 'AdGuard') ? "45.90.28.66" : "1.1.1.1";
            let dns2 = (type === 'AdGuard') ? "45.90.30.66" : "1.0.0.1";
            const bat = `@echo off\ntitle ${type} Setup\nnet session >nul 2>&1 || (echo Vui long chay bang quyen Admin! && pause && exit)\nfor /f "tokens=3*" %%i in ('netsh interface show interface ^| findstr "Connected"') do (\nnetsh interface ip set dnsservers "%%j" static ${dns1} validate=no\nnetsh interface ip add dnsservers "%%j" ${dns2} index=2 validate=no\n)\nipconfig /flushdns\necho [OK] Da kich hoat ${type}!\npause`;
            
            // ƒê√£ ƒë·ªïi t√™n file t·∫£i v·ªÅ th√†nh _Windows.bat theo y√™u c·∫ßu
            downloadFile(bat, `${type}_Windows.bat`);
            
            showModal(type, [
                "M·ªü file <b>" + type + "_Windows.bat</b> v·ª´a t·∫£i v·ªÅ.",
                "Chu·ªôt ph·∫£i ch·ªçn <b>Run as Administrator</b> ƒë·ªÉ c·∫•p quy·ªÅn.",
                "Khi th·∫•y th√¥ng b√°o [OK], nh·∫•n ph√≠m b·∫•t k·ª≥ ƒë·ªÉ k·∫øt th√∫c."
            ]);
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            a.click();
        }

        function closeModal() { document.getElementById('guideModal').style.display = 'none'; }
    </script>
</body>
</html>

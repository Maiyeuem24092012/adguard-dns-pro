<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS Smart Engine Pro</title>
    <style>
        :root { --ag-green: #67bc91; --cf-orange: #f38020; --ag-dark: #0f0f0f; --ag-card: #1c1c1e; --ag-gray: #8e8e93; --ag-red: #ff453a; }
        body { background: var(--ag-dark); color: white; font-family: -apple-system, sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 40px; overflow-x: hidden; }
        
        .header { margin-top: 20px; font-weight: bold; letter-spacing: 2px; color: var(--ag-gray); font-size: 14px; }

        /* KHU V·ª∞C KHI√äN BI·ªÇU T∆Ø·ª¢NG */
        .shield-section { margin: 40px 0; position: relative; width: 200px; height: 200px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; }
        
        /* Hi·ªáu ·ª©ng s√≥ng lan t·ªèa (S√≥ng xanh) */
        .ripple { position: absolute; width: 140px; height: 140px; border: 2px solid var(--ag-green); border-radius: 50%; opacity: 0; display: none; }
        .scanning .ripple { display: block; animation: ripple-out 1.5s linear infinite; }
        .scanning .ripple:nth-child(2) { animation-delay: 0.5s; }
        .scanning .ripple:nth-child(3) { animation-delay: 1s; }

        /* Loader ƒëa t·∫ßng */
        .loader-multi { 
            position: absolute; width: 185px; height: 185px; border-radius: 50%; 
            border: 2px solid transparent; border-top: 3px solid var(--ag-green); border-bottom: 3px solid var(--ag-green);
            display: none; animation: spin-cool 1s linear infinite; filter: drop-shadow(0 0 10px var(--ag-green));
        }
        .loader-multi::before {
            content: ""; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border-radius: 50%; border: 2px solid transparent; border-left: 3px solid #fff; border-right: 3px solid #fff;
            opacity: 0.6; animation: spin-reverse 1.5s linear infinite;
        }
        .loader-multi::after {
            content: ""; position: absolute; top: 25px; left: 25px; right: 25px; bottom: 25px;
            border-radius: 50%; border: 2px dashed var(--ag-green); opacity: 0.4; animation: spin-cool 3s linear infinite;
        }
        
        /* Bi·∫øn th·ªÉ Loader m√†u ƒë·ªè khi t·∫Øt */
        .loader-off { border-top-color: var(--ag-red) !important; border-bottom-color: var(--ag-red) !important; filter: drop-shadow(0 0 10px var(--ag-red)) !important; }
        .loader-off::after { border-color: var(--ag-red) !important; }

        .shield-circle { width: 140px; height: 140px; border-radius: 50%; border: 4px solid #333; transition: 0.4s; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.02); z-index: 2; }
        .active-circle { border-color: var(--ag-green) !important; box-shadow: 0 0 30px var(--ag-green), inset 0 0 20px var(--ag-green); background: rgba(103, 188, 145, 0.1) !important; }
        .shield-icon { font-size: 60px; transition: 0.5s; filter: grayscale(1); opacity: 0.3; }
        .active-icon { filter: grayscale(0) !important; opacity: 1 !important; transform: scale(1.1); }

        @keyframes spin-cool { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes spin-reverse { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
        @keyframes ripple-out { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(1.8); opacity: 0; } }

        /* NH√ÉN TR·∫†NG TH√ÅI */
        .status-label { font-size: 18px; font-weight: bold; color: #555; margin-bottom: 5px; text-transform: uppercase; transition: 0.3s; }
        .status-on { color: var(--ag-green) !important; text-shadow: 0 0 10px rgba(103, 188, 145, 0.5); }
        .status-loading-off { color: var(--ag-red) !important; }
        
        #device-info { font-size: 12px; color: var(--ag-gray); margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 5px 15px; border-radius: 20px; border: 1px solid #333; display: none; }

        /* HI·ªÜU ·ª®NG TR∆Ø·ª¢T MENU (SLIDE UP/DOWN) */
        #setup-menu { 
            width: 92%; max-width: 420px; 
            overflow: hidden; 
            max-height: 0; /* ƒê√≥ng */
            opacity: 0; 
            transform: translateY(20px) scale(0.98);
            transition: max-height 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
                        opacity 0.4s ease, 
                        transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .menu-open { 
            max-height: 1200px !important; /* M·ªü */
            opacity: 1 !important; 
            transform: translateY(0) scale(1) !important;
            margin-bottom: 20px;
        }

        .group-title { font-size: 11px; color: var(--ag-gray); margin: 25px 5px 10px; text-transform: uppercase; font-weight: bold; }
        .menu-item { background: var(--ag-card); border-radius: 15px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: 0.2s; border: 1px solid #2c2c2e; }
        .menu-item:active { transform: scale(0.96); }
        .icon-box { width: 40px; height: 40px; background: #2c2c2e; border-radius: 10px; margin-right: 15px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .badge { font-size: 10px; padding: 3px 10px; border-radius: 10px; font-weight: bold; background: #333; }

        /* CHECKER BOX */
        .checker-box { width: 92%; max-width: 420px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #333; }
        .check-item { background: #151517; border-radius: 12px; padding: 15px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; font-size: 14px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--ag-gray); margin-right: 10px; display: inline-block; }
        .dot-on { background: var(--ag-green); box-shadow: 0 0 10px var(--ag-green); }

        /* MODAL */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); }
        .modal-content { background: #1c1c1e; margin: 10% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 380px; border: 1px solid #333; max-height: 85vh; overflow-y: auto; }
        .modal-title { font-size: 18px; font-weight: bold; color: var(--ag-green); margin-bottom: 25px; text-align: center; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .step-row { display: flex; align-items: flex-start; margin-bottom: 20px; } 
        .step-circle { background: var(--ag-green); color: black; border-radius: 50%; min-width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: bold; margin-right: 15px; margin-top: 2px; }
        .step-text { font-size: 15px; line-height: 1.6; color: #ddd; flex: 1; }
        .btn-close { width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--ag-green); color: black; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .btn-link { color: var(--ag-green); text-decoration: underline; font-weight: bold; }
        .copy-box { background: #000; padding: 12px; border-radius: 8px; color: var(--ag-green); font-family: monospace; margin: 10px 0; border: 1px dashed var(--ag-green); word-break: break-all; text-align: center; cursor: pointer; }
        .choice-container { display: flex; gap: 10px; margin-top: 15px; }
        .btn-choice { flex: 1; padding: 15px; border-radius: 12px; border: 1px solid #444; background: #2c2c2e; color: white; cursor: pointer; font-weight: bold; font-size: 13px; }
    </style>
</head>
<body>

    <div class="header">DNS SMART ENGINE PRO</div>

    <div class="shield-section" id="shield-container" onclick="toggleSystem()">
        <div class="ripple"></div><div class="ripple"></div><div class="ripple"></div>
        <div class="loader-multi" id="loader"></div>
        <div class="shield-circle" id="circle"><div class="shield-icon" id="icon">üõ°Ô∏è</div></div>
    </div>

    <div class="status-label" id="status">CH·∫æ ƒê·ªò CH·ªú</div>
    <div id="device-info">ƒêang nh·∫≠n di·ªán thi·∫øt b·ªã...</div>

    <div id="setup-menu">
        <div class="group-title">ADGUARD (CH·∫∂N QU·∫¢NG C√ÅO)</div>
        <div class="menu-item" onclick="downloadWindows('AdGuard')">
            <div style="display:flex; align-items:center;"><div class="icon-box">üñ•Ô∏è</div><div><b>Windows Auto Fix</b></div></div>
            <div class="badge" style="color:var(--ag-green)">BAT</div>
        </div>
        <div class="menu-item" onclick="handleInstall('ios', 'AdGuard')">
            <div style="display:flex; align-items:center;"><div class="icon-box">üçé</div><div><b>iOS Profile</b></div></div>
            <div class="badge" style="color:var(--ag-green)">MOBILECONFIG</div>
        </div>
        <div class="menu-item" onclick="askAndroid('AdGuard')">
            <div style="display:flex; align-items:center;"><div class="icon-box">ü§ñ</div><div><b>Android Setup</b></div></div>
            <div class="badge" style="color:var(--ag-green)">AUTO</div>
        </div>

        <div class="group-title">CLOUDFLARE (T·ªêC ƒê·ªò 1.1.1.1)</div>
        <div class="menu-item" onclick="downloadWindows('Cloudflare')">
            <div style="display:flex; align-items:center;"><div class="icon-box">‚ö°</div><div><b>Windows 1.1.1.1</b></div></div>
            <div class="badge" style="color:var(--cf-orange)">FAST</div>
        </div>
        <div class="menu-item" onclick="handleInstall('ios', 'Cloudflare')">
            <div style="display:flex; align-items:center;"><div class="icon-box">üçé</div><div><b>iOS 1.1.1.1</b></div></div>
            <div class="badge" style="color:var(--cf-orange)">SECURE</div>
        </div>
        <div class="menu-item" onclick="askAndroid('Cloudflare')">
            <div style="display:flex; align-items:center;"><div class="icon-box">ü§ñ</div><div><b>Android Setup</b></div></div>
            <div class="badge" style="color:var(--cf-orange)">AUTO</div>
        </div>
    </div>

    <div class="checker-box">
        <div class="group-title" style="color:var(--ag-red);">KI·ªÇM TRA TH·ª∞C T·∫æ</div>
        <div class="check-item">
            <span><span class="dot" id="dot-ag"></span>AdGuard Status</span>
            <small id="txt-ag" style="color:var(--ag-gray)">OFFLINE</small>
        </div>
        <div class="check-item">
            <span><span class="dot" id="dot-cf"></span>Cloudflare Status</span>
            <small id="txt-cf" style="color:var(--ag-gray)">OFFLINE</small>
        </div>
        <button onclick="runCheck()" style="width:100%; padding:12px; border-radius:10px; border:none; background:#222; color:white; font-weight:bold; cursor:pointer; margin-top:10px;">L√ÄM M·ªöI QU√âT</button>
    </div>

    <div id="guideModal" class="modal">
        <div class="modal-content">
            <div id="modalTitle" class="modal-title">H∆Ø·ªöNG D·∫™N</div>
            <div id="modalSteps" class="step-list"></div>
            <button class="btn-close" id="btn-modal-main-close">ƒê√É HI·ªÇU</button>
        </div>
    </div>

    <div id="androidChoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">C·∫§U H√åNH ANDROID</div>
            <div class="choice-container">
                <button class="btn-choice" id="btn-old-android">Android 8 tr·ªü xu·ªëng</button>
                <button class="btn-choice" id="btn-new-android" style="border-color: var(--ag-green);">Android 9 tr·ªü l√™n</button>
            </div>
            <button class="btn-close" onclick="closeChoiceModal()" style="background:#333; color:white;">QUAY L·∫†I</button>
        </div>
    </div>

    <script>
        let isPowerOn = false;
        const AG_ID = "cc1a659b-a5b6-4fb1-b829-4ee1969f1c99";
        let tempType = "";

        window.onload = () => { 
            runCheck(); 
            if (localStorage.getItem('dnsPower') === 'true') applyOnUI();
            setInterval(runCheck, 30000);
        };

        function detectDevice() {
            const ua = navigator.userAgent;
            let name = "Android Device"; let version = "Android";
            if (ua.indexOf("Windows NT 10.0") !== -1) { name = "PC / LAPTOP"; version = "Windows 10/11"; }
            else if (/iPhone|iPad|iPod/.test(ua)) { name = "iPhone/iPad"; version = "iOS"; }
            return { name, version };
        }

        function toggleSystem() {
            const loader = document.getElementById('loader');
            const container = document.getElementById('shield-container');
            const statusTxt = document.getElementById('status');

            if (!isPowerOn) {
                container.classList.add('scanning');
                loader.classList.remove('loader-off');
                loader.style.display = "block";
                statusTxt.innerText = "ƒêANG QU√âT ƒêA T·∫¶NG...";
                
                setTimeout(() => {
                    container.classList.remove('scanning');
                    loader.style.display = "none";
                    applyOnUI();
                    localStorage.setItem('dnsPower', 'true');
                }, 2000); 
            } else {
                loader.classList.add('loader-off');
                loader.style.display = "block";
                statusTxt.innerText = "ƒêANG NG·∫ÆT K·∫æT N·ªêI...";
                statusTxt.classList.add('status-loading-off');

                applyOffUI();
                localStorage.setItem('dnsPower', 'false');

                setTimeout(() => {
                    loader.style.display = "none";
                    statusTxt.innerText = "CH·∫æ ƒê·ªò CH·ªú";
                    statusTxt.classList.remove('status-loading-off');
                }, 1500);
            }
        }

        function applyOnUI() {
            isPowerOn = true;
            document.getElementById('circle').classList.add('active-circle');
            document.getElementById('icon').classList.add('active-icon');
            document.getElementById('status').innerText = "H·ªÜ TH·ªêNG ƒê√É M·ªû";
            document.getElementById('status').classList.add('status-on');
            document.getElementById('setup-menu').classList.add('menu-open');
            const info = detectDevice();
            document.getElementById('device-info').style.display = "block";
            document.getElementById('device-info').innerHTML = `üì° <b>${info.name}</b> | ${info.version}`;
        }

        function applyOffUI() {
            isPowerOn = false;
            document.getElementById('circle').classList.remove('active-circle');
            document.getElementById('icon').classList.remove('active-icon');
            document.getElementById('status').classList.remove('status-on');
            document.getElementById('setup-menu').classList.remove('menu-open');
            document.getElementById('device-info').style.display = "none";
        }

        function askAndroid(type) {
            tempType = type;
            document.getElementById('androidChoiceModal').style.display = 'block';
            document.getElementById('btn-old-android').onclick = () => { closeChoiceModal(); handleOpenVPN(type); };
            document.getElementById('btn-new-android').onclick = () => { closeChoiceModal(); handlePrivateDNS(type); };
        }

        function handleOpenVPN(type) {
            const host = (type === 'AdGuard') ? "45.90.28.66" : "1.1.1.1";
            const ovpn = `client\ndev tun\nproto udp\nremote ${host} 53\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nsetenv CLIENT_CERT 0\nremote-cert-tls server\nverb 3\ndhcp-option DNS ${host}`;
            downloadFile(ovpn, `${type}_Android_Fixed.ovpn`, 'text/plain');
            showModal(type, [
                `T·∫£i app <a class="btn-link" href="https://play.google.com/store/apps/details?id=net.openvpn.openvpn" target="_blank">OpenVPN Connect</a>.`,
                "Import file v·ª´a t·∫£i. Nh·∫•n <b>CONTINUE</b>.",
                "File n√†y ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·∫∑c bi·ªát ƒë·ªÉ <b>B·ªé QUA L·ªñI CA</b>."
            ], false);
        }

        function handlePrivateDNS(type) {
            const dnsCode = (type === 'AdGuard') ? `${AG_ID}.dns.nextdns.io` : "one.one.one.one";
            navigator.clipboard.writeText(dnsCode);
            showModal(type, [
                `<b style="color:var(--ag-green)">‚úÖ ƒê√É T·ª∞ ƒê·ªòNG COPY M√É</b>`,
                `M√£ DNS: <div class="copy-box">${dnsCode}</div>`,
                "D√°n m√£ v√†o m·ª•c <b>DNS c√° nh√¢n</b> trong c√†i ƒë·∫∑t."
            ], 'android');
        }

        function downloadWindows(type) {
            let dns1 = (type === 'AdGuard') ? "45.90.28.66" : "1.1.1.1";
            let dns2 = (type === 'AdGuard') ? "45.90.30.66" : "1.0.0.1";
            const bat = `@echo off\ntitle ${type} Setup\nnet session >nul 2>&1 || (echo Chay Admin! && pause && exit)\nfor /f "tokens=3*" %%i in ('netsh interface show interface ^| findstr "Connected"') do (\nnetsh interface ip set dnsservers "%%j" static ${dns1} validate=no\nnetsh interface ip add dnsservers "%%j" ${dns2} index=2 validate=no\n)\nipconfig /flushdns\npause`;
            downloadFile(bat, `${type}_Windows.bat`, 'text/plain');
            showModal(type, ["Ch·∫°y file b·∫±ng quy·ªÅn Admin.", "Hi·ªán [OK] l√† xong."], false);
        }

        function handleInstall(platform, type) {
            if (platform === 'ios') {
                let url = (type === 'AdGuard') ? `https://dns.nextdns.io/${AG_ID}` : "https://cloudflare-dns.com/dns-query";
                const profile = `<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><plist version="1.0"><dict><key>PayloadContent</key><array><dict><key>DNSSettings</key><dict><key>DNSProtocol</key><string>HTTPS</string><key>ServerURL</key><string>${url}</string></dict><key>PayloadType</key><string>com.apple.dnsSettings.managed</string></dict></array><key>PayloadDisplayName</key><string>${type} DNS</string><key>PayloadUUID</key><string>1</string><key>PayloadType</key><string>Configuration</string><key>PayloadVersion</key><integer>1</integer><key>PayloadIdentifier</key><string>com.dns</string></dict></plist>`;
                downloadFile(profile, `${type}_iOS.mobileconfig`, 'application/x-apple-aspen-config');
                showModal(type, ["T·∫£i c·∫•u h√¨nh xong, v√†o <b>C√†i ƒë·∫∑t</b> ƒë·ªÉ x√°c nh·∫≠n."], 'ios');
            }
        }

        async function runCheck() {
            const img = new Image();
            img.onload = () => updateUI('ag', true, 'ACTIVE');
            img.onerror = () => updateUI('ag', false, 'OFFLINE');
            img.src = `https://${AG_ID}.dns.nextdns.io/favicon.ico?` + Date.now();
            try {
                const res = await fetch('https://1.1.1.1/cdn-cgi/trace');
                const text = await res.text();
                updateUI('cf', text.includes('dns=on'), text.includes('dns=on') ? 'ONLINE' : 'OFFLINE');
            } catch (e) { updateUI('cf', false, 'OFFLINE'); }
        }

        function updateUI(id, active, text) {
            const dot = document.getElementById('dot-' + id);
            const txt = document.getElementById('txt-' + id);
            if(dot && txt) {
                dot.className = active ? 'dot dot-on' : 'dot';
                txt.innerText = text; txt.style.color = active ? "var(--ag-green)" : "var(--ag-gray)";
            }
        }

        function showModal(type, steps, autoRedirect) {
            document.getElementById('modalTitle').innerText = "C√ÄI ƒê·∫∂T " + type.toUpperCase();
            let html = "";
            steps.forEach((s, i) => html += `<div class="step-row"><div class="step-circle">${i+1}</div><div class="step-text">${s}</div></div>`);
            document.getElementById('modalSteps').innerHTML = html;
            const closeBtn = document.getElementById('btn-modal-main-close');
            closeBtn.onclick = () => {
                closeModal();
                if (autoRedirect === 'ios') window.location.href = "prefs:root=General&path=ManagedConfigurationList";
                else if (autoRedirect === 'android') {
                    const intents = ["intent:#Intent;action=android.settings.DNS_SETTINGS;end", "intent:#Intent;action=android.settings.SETTINGS;end"];
                    let i = 0;
                    function tryRedirect() {
                        if (i < intents.length) { window.location.href = intents[i]; i++; setTimeout(tryRedirect, 300); }
                    }
                    tryRedirect();
                }
            };
            document.getElementById('guideModal').style.display = 'block';
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob); a.download = filename; a.click();
        }

        function closeModal() { document.getElementById('guideModal').style.display = 'none'; }
        function closeChoiceModal() { document.getElementById('androidChoiceModal').style.display = 'none'; }
    </script>
</body>
</html>

